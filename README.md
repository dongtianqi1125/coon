# coon（分布式协调服务）

微服务分布式协调服务：微服务注册中心、微服务配置中心、微服务分布式锁

## 0 设计模式
### 0.1 拉模式
拉模式主要解决一些未知情况发生而导致数据没有通知至每一个客户端的情况。

### 0.2 推模式
如果推送模式足够可靠，或者使用场景要求不高时，可以使用推模式，减少系统资源的开销。

### 0.3.1 可靠的透明化设计模式
推模式+透明监控+拉模式


## 1 微服务注册中心(mreg)

建议方案：Zookeeper（推模式）

### 1.1 解决方案
- Multicast注册中心
- Redis注册中心
- Zookeeper注册中心

### 1.2 核心功能
- 注册服务：用于将应用信息发布至注册中心（一般使用Zookeeper）上，从而方便其他消费者即使发现
- 注销服务：用于将已发布的信息从注册中心进行主动摘除，从而即使通知其它订阅者及时清除本地的数据
- 订阅服务：用于观察订阅注册中心某个服务的所有提供实例地址信息，当实例列表发生变化时及时进行通知
- 退订服务：用于取消已订阅的观察者，从而减少需要通知的客户终端地址
- 查找服务：用于给管理端提供实时查询数据的接口

### 1.3 生产特性
- 连接断开自动重连
- 连接失败自动切换
- 数据过期自动清理（超时自动摘除）
- 断开重连后自动恢复（自动再次注册、订阅或监听）
- 失败自动重试（注册、注销、订阅、退订、监听和取消监听失败，无限重试至成功为止）
- 订阅的服务清单自动离线缓存（变更通知时更新）


## 2 微服务配置中心(mconf)

建议方案：Redis（拉模式）+配置版本号上报监控

### 2.1 解决方案
- Redis配置中心（定时拉模式）
- Zookeeper配置中心（订阅模式）

### 2.2 核心功能
- 发布配置
- 变更配置
- 删除配置
- 订阅配置
- 退订配置
- 查找配置

### 2.3 生产特性
- 透明监控应用配置版本情况


## 3 微服务分布式锁(mlock)

TODO

